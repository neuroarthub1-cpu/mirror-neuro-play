<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Embodied Neuro-Art Feedback</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- âœ… CORRECTED MEDIAPIPE IMPORTS (NO .js) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      font-family: sans-serif;
    }
    #canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    #info {
      position: fixed;
      bottom: 12px;
      left: 12px;
      color: white;
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<video id="video" autoplay playsinline style="display:none"></video>
<canvas id="canvas"></canvas>

<div id="info">
  Move your hand slowly.<br>
  Soften your face.<br>
  Observe the response.
</div>

<script>
/* ================= BASIC SETUP ================= */

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ================= STATE ================= */

let mouthOpen = 0;
let handX = 0.5;

let smoothMouth = 0;
let smoothHand = 0;

/* ================= FACEMESH ================= */

const faceMesh = new FaceMesh({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
});

faceMesh.setOptions({
  maxNumFaces: 1,
  refineLandmarks: true,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

faceMesh.onResults(results => {
  if (!results.multiFaceLandmarks) return;

  const landmarks = results.multiFaceLandmarks[0];
  const upperLip = landmarks[13];
  const lowerLip = landmarks[14];

  mouthOpen = Math.abs(upperLip.y - lowerLip.y) * 10;
});

/* ================= HANDS ================= */

const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
});

hands.onResults(results => {
  if (!results.multiHandLandmarks) return;

  const indexTip = results.multiHandLandmarks[0][8];
  handX = indexTip.x;
});

/* ================= CAMERA ================= */

const camera = new Camera(video, {
  onFrame: async () => {
    await faceMesh.send({ image: video });
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});

camera.start();

/* ================= RENDER LOOP ================= */

function draw() {
  requestAnimationFrame(draw);

  smoothMouth += (mouthOpen - smoothMouth) * 0.05;
  smoothHand += (handX - smoothHand) * 0.05;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const hue = Math.min(360, smoothMouth * 120);
  const rotation = smoothHand * Math.PI * 2;
  const size = 120 + smoothMouth * 250;

  ctx.save();
  ctx.translate(canvas.width / 2, canvas.height / 2);
  ctx.rotate(rotation);

  ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
  ctx.beginPath();
  ctx.arc(0, 0, size, 0, Math.PI * 2);
  ctx.fill();

  ctx.restore();
}

draw();
</script>

</body>
</html>

